<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>d3.carto - Tutorial 3</title>
    <meta charset="utf-8" />
    <link type="text/css" rel="stylesheet" href="d3map.css" />
    <link type="text/css" rel="stylesheet" href="style.css" />
</head>
<script>
    function makeSomeMaps() {

        var colorScale = d3.scale.quantize().domain([50,1000]).range(colorbrewer.Reds[5])

        map = d3.carto.map();

        randomLayerArray = [];

        d3.select("#map").call(map);

        d3.select("#d3MapPanBox > #left").html("&#9664;")
        d3.select("#d3MapPanBox > #right").html("&#9654;")
        d3.select("#d3MapPanBox > #up").html("&#9650;")
        d3.select("#d3MapPanBox > #down").html("&#9660;")

        tileLayer = d3.carto.layer();
        tileLayer
            .type("tile")
            .path("elijahmeeks.map-azn21pbi")
            .label("Base")

        csvLayer = d3.carto.layer.csv();
        csvLayer
            .path("all_sites.csv")
            .label("CSV Points")
            .cssClass("point")
            .renderMode("canvas")
            .markerSize(2)
            .markerColor(function(d) {return colorScale(d.pop)})
            .strokeColor("black")
            .x("xcoord")
            .y("ycoord");

        map.addCartoLayer(tileLayer).addCartoLayer(csvLayer);


        function createRandomDataLayer() {
            var randomPoints = d3.range(100).map(function() {return {x: 180 - (Math.random() * 360), y: 90 - (Math.random() * 180)}});

            var randomRender = "canvas"

            if (Math.random() > .5) {
                randomRender = "svg"
            }
            var newRandomLayer = d3.carto.layer.xyArray();

            console.log(newRandomLayer)

            newRandomLayer
                .features(randomPoints)
                .x("x")
                .y("y")
                .label("Random Layer")
                .renderMode(randomRender)
                .cssClass("random" + randomRender)

            map.addCartoLayer(newRandomLayer);
            randomLayerArray.push(newRandomLayer);

        }


        map.mode("globe");




        d3.select("#buttons").append("button").html("Globe Mode").on("click", function() {map.mode("globe");})
        d3.select("#buttons").append("button").html("Projection Mode").on("click", function() {map.mode("projection");})
        d3.select("#buttons").append("button").html("Standard Mode").on("click", function() {map.mode("transform");})
        d3.select("#buttons").append("button").html("Add a Random Data Layer").on("click", createRandomDataLayer)


    }

</script>
<body onload="makeSomeMaps()">
<div id="buttons"></div>
<div id="map"></div>

<footer>
    <script src="http://d3js.org/colorbrewer.v1.min.js" charset="utf-8" type="text/javascript"></script>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8" type="text/javascript"></script>
    <script src="http://d3js.org/topojson.v1.min.js" type="text/javascript">
    </script>
    <script src="http://bl.ocks.org/emeeks/raw/f3105fda25ff785dc5ed/tile.js" type="text/javascript">
    </script>
    <script src="https://rawgit.com/emeeks/d3-carto-map/master/d3.carto.map.js" type="text/javascript">
    </script>
    <script src="http://bl.ocks.org/emeeks/raw/f3105fda25ff785dc5ed/d3.quadtiles.js" type="text/javascript">
    </script>
    <script src="http://bl.ocks.org/emeeks/raw/f3105fda25ff785dc5ed/d3.geo.raster.js" type="text/javascript">
    </script>
</footer>
</body>
</html>